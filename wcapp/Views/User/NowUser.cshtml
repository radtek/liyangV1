@using WCAPP.Models.Database
@using WCAPP.Utils
@using WCAPP.Types
@model WCAPP.Models.HomeModels.LoginModel
<div style="border: 1px solid #eee; padding: 10px;">
    <div class="tabbable">
        <!-- Only required for left/right tabs -->
        <ul class="nav nav-tabs">
            <li class="active"><a style="font-size: 16px" href="#tab1" data-toggle="tab">员工信息</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab1">
                <table class="table table-striped table-hover text-center">
                    <thead>
                        <tr>
                            <th class="text-center">工号</th>
                            <th class="text-center">姓名</th>
                            <th class="text-center">性别</th>
                            <th class="text-center">部门</th>
                            <th class="text-center">岗位</th>
                            <th class="text-center">权限</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.Useres != null)
                        {
                            <tr>
                                <td>@ViewBag.Useres.Id</td>
                                <td>@ViewBag.Useres.Name</td>
                                <td>@ViewBag.Useres.Sex</td>
                                <td>@ViewBag.Useres.Department</td>
                                <td>@ViewBag.Useres.Position</td>
                                @{
                                    String str = null;
                                    List<Authority> auths = ViewBag.Authorities;
                                    foreach (Authority auth in Enum.GetValues(typeof(Authority)))
                                    {

                                        str += auth.ToString() + ",";

                                    }
                                    <td>@str</td>
                                }
                                <td><button style="padding: 2px 6px 0 6px; font-size: 13px" class="btn btn-danger" onclick="ModifyPassword()">修改密码</button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="modifyPassword" style="display: none;margin: 0 auto; text-align: center;">
        <div class="text-center">
            <div style="display: inline-block">

                @*@using (Html.BeginForm("NowUser", "User", FormMethod.Post, new { id = "modifypassword" }))*@
                @using (Ajax.BeginForm("NowUser", "User", FormMethod.Post, new AjaxOptions { OnSuccess = "onSimple" },new { @id= "modifypassword" }))

                {
            <div style="text-align:center; padding: 20px ;">
                <span style="width: 30px; display: inline">旧密码</span>
                <span style="width: 200px;">@Html.PasswordFor(m => m.Password, new { @class = "password", placeholder = "输入旧密码", id = "pwd" })</span>
                @*<span>@Html.ValidationMessageFor(m => m.Password, "用户密码错误", new { @class = "password", placeholder = "密码" })</span>*@

            </div>
            <span>@Html.ValidationMessage("Password", new { style = "font-size:14px;color:red" })</span>

            <div style="text-align:center; padding: 20px ;">
                <span style="width: 30px; display: inline">新密码</span>
                <span style="width: 200px;">@Html.PasswordFor(m => m.Password0, new { @class = "password", placeholder = "输入新密码", id = "pwd0" })</span>
                @*<span>@Html.ValidationMessageFor(m => m.Password0, "新密码两次输入不一致，请再次输入！", new { @class = "password", placeholder = "密码" })</span>*@

            </div>
            <span>@Html.ValidationMessage("Password0", new { style = "font-size:14px;color:red" })</span>

            <div style="text-align: center; padding: 20px ;">
                <span style="width: 30px; display: inline">新密码</span>
                <span style="width: 200px;"> @Html.PasswordFor(m => m.Password1, new { @class = "password", placeholder = "确认新密码", id = "pwd1" })</span>
                @*<span>@Html.ValidationMessageFor(m => m.Password1, "请重新输入", new { @class = "password1", placeholder = "密码" })</span>*@

            </div>
            <span>@Html.ValidationMessage("Password1", new { style = "font-size:14px;color:red" })</span>
            <div style="text-align: center; padding: 20px ;">
                <input class="btn btn-primary" type="submit" value="确认修改" />
                <button class="btn btn-info" onclick="$('#modifyPassword').dialog('close')">取消</button>
            </div>
            @Html.HiddenFor(m => m.Password, new { id = "pwd2" })
            @Html.HiddenFor(m => m.Password0, new { id = "pwd3" })
            @Html.HiddenFor(m => m.Password1, new { id = "pwd4" })
}

            </div>
           
        </div>
    </div>
    <div style="margin: 0 auto; text-align: center;">
        @*<div type="submit" class="btn btn-large btn-primary"> @Html.ActionLink("修改密码", "ModifyPassword", "User", new { area = "" }, null)</div>*@
        <button style="padding: 12px 16px 10 16px; font-size: 14px" class="btn btn-primary" onclick="ModifyPassword()">修改密码</button>
    </div>
</div>

@section scripts
    {
    <script>
        function onSimple(data){
            if (data.succeed) {
                alert(data.error);
                reload();
            } else {
                alert(data.error);
                reload();
            }
        }
        function ModifyPassword() {     
           
            $("#modifyPassword").dialog({ width: "400px" });
           
        }
        $(function () {
            $("#modifypassword").submit(function () {
                $("#pwd2").val(hex_md5($("#pwd").val()));
                $("#pwd3").val(hex_md5($("#pwd0").val()));
                $("#pwd4").val(hex_md5($("#pwd1").val()));
                $("#pwd").attr("disabled", "true");
                $("#pwd0").attr("disabled", "true");
                $("#pwd1").attr("disabled", "true");
                return true;
            });
        });
        
    </script>
}